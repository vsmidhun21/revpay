<div class="dashboard-layout">

  <!-- ‚îÄ‚îÄ Loading State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <!-- ‚Üê CHANGED: added loading overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
  </div>

  <!-- ‚îÄ‚îÄ Full Dashboard (only when profile is loaded) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <!-- ‚Üê CHANGED: wrapped everything in *ngIf="!loading && profile" -->
  <ng-container *ngIf="!loading && profile">

    <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <aside class="sidebar">
      <a routerLink="/" class="logo">
        <span class="logo-mark">R</span>
        <span class="logo-text">RevPay</span>
      </a>

      <nav class="nav-menu">
        <a class="nav-item active" href="#">
          <span class="nav-icon">‚äû</span> Dashboard
        </a>
        <a class="nav-item" href="#">
          <span class="nav-icon">‚Üï</span> Transactions
        </a>
        <a class="nav-item" href="#">
          <span class="nav-icon">üí≥</span> Payment Methods
        </a>
        <a class="nav-item" href="#">
          <span class="nav-icon">üì©</span> Requests
          <span class="nav-badge">2</span>
        </a>
        <a class="nav-item" href="#">
          <span class="nav-icon">üîî</span> Notifications
          <span class="nav-badge">3</span>
        </a>
        <a class="nav-item" href="#">
          <span class="nav-icon">‚öô</span> Settings
        </a>

        <!-- ‚Üê CHANGED: show extra business nav items for business accounts -->
        <ng-container *ngIf="profile!.accountType === 'BUSINESS'">
          <div class="nav-divider"></div>
          <a class="nav-item" href="#">
            <span class="nav-icon">üßæ</span> Invoices
          </a>
          <a class="nav-item" href="#">
            <span class="nav-icon">üè¶</span> Loans
          </a>
          <a class="nav-item" href="#">
            <span class="nav-icon">üìä</span> Analytics
          </a>
        </ng-container>
      </nav>

      <div class="sidebar-footer">
        <div class="user-chip">
          <!-- ‚Üê CHANGED: initials from real profile instead of hardcoded "AJ" -->
          <div class="user-avatar">{{ initials }}</div>
          <div class="user-info">
            <!-- ‚Üê CHANGED: real name and account type from profile -->
            <div class="user-name">{{ profile!.fullName }}</div>
            <div class="user-type">{{ profile!.accountType | titlecase }} Account</div>
          </div>
        </div>
        <button class="logout-btn" (click)="logout()" [disabled]="loggingOut"
          [title]="loggingOut ? 'Signing out...' : 'Sign out'">
          <span *ngIf="!loggingOut">‚èª</span>
          <span *ngIf="loggingOut" class="logout-spinner"></span>
        </button>
      </div>
    </aside>

    <!-- ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <main class="main">

      <!-- Top bar -->
      <div class="topbar">
        <div>
          <!-- ‚Üê CHANGED: firstName getter used instead of .split(' ')[0] -->
          <h1 class="page-title">{{ greeting }}, {{ firstName }} {{ greetingEmoji }}</h1>
          <!-- ‚Üê CHANGED: show business name for business, email for personal -->
          <p class="page-sub">
            <ng-container *ngIf="profile!.accountType === 'BUSINESS'">
              {{ profile!.businessName }}
            </ng-container>
            <ng-container *ngIf="profile!.accountType !== 'BUSINESS'">
              Here's what's happening with your account today.
            </ng-container>
          </p>
        </div>
        <div class="topbar-right">
          <button class="icon-btn">üîî <span class="notif-dot"></span></button>
          <!-- ‚Üê CHANGED: initials from real profile -->
          <div class="user-avatar sm">{{ initials }}</div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ Business Pending Verification Banner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <!-- ‚Üê CHANGED: new banner ‚Äî only shown for pending business accounts -->
      <div class="banner-warning" *ngIf="isBusinessPendingVerification">
        <span class="banner-icon">‚ö†</span>
        <span>
          Your business account is <strong>pending verification.</strong>
          Some features may be restricted until verification is complete.
        </span>
      </div>

      <!-- ‚îÄ‚îÄ Balance + Quick Actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="top-row">

        <!-- Wallet card -->
        <div class="wallet-card">
          <div class="wallet-bg-circle"></div>
          <div class="wallet-label">Total Wallet Balance</div>
          <!-- ‚Üê CHANGED: real balance from profile -->
          <div class="wallet-balance">
            ‚Çπ{{ profile!.walletBalance | number:'1.2-2' }}
          </div>
          <div class="wallet-meta">
            <!-- ‚Üê CHANGED: show linked bank account details from profile -->
            <ng-container *ngIf="profile!.bankAccount as bank">
              <div class="meta-item">
                <span class="meta-icon bank">üè¶</span>
                <div>
                  <div class="meta-label">Linked Bank</div>
                  <div class="meta-value">
                    {{ bank.bankName }} ¬∑¬∑{{ bank.accountNumber | slice:-4 }}
                  </div>
                </div>
              </div>
              <div class="meta-divider"></div>
            </ng-container>
            <div class="meta-item">
              <span class="meta-icon success">‚úì</span>
              <div>
                <div class="meta-label">Account</div>
                <div class="meta-value">Active</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick actions -->
        <div class="quick-actions-card">
          <div class="card-title">Quick Actions</div>
          <div class="actions-grid">
            <button class="action-btn" *ngFor="let a of quickActions" [style.--action-color]="a.color">
              <span class="action-icon">{{ a.icon }}</span>
              <span class="action-label">{{ a.label }}</span>
            </button>
          </div>
        </div>

      </div>

      <!-- ‚îÄ‚îÄ Transactions + Notifications ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="bottom-row">

        <!-- Recent transactions -->
        <div class="transactions-card">
          <div class="card-header">
            <div class="card-title">Recent Transactions</div>
            <a href="#" class="see-all">See all ‚Üí</a>
          </div>
          <div class="txn-list">
            <div class="txn-item" *ngFor="let t of transactions">
              <div class="txn-icon" [class]="t.type">{{ t.icon }}</div>
              <div class="txn-info">
                <div class="txn-name">{{ t.name }}</div>
                <div class="txn-note">{{ t.note }}</div>
              </div>
              <div class="txn-right">
                <div class="txn-amount" [class.positive]="t.amount > 0" [class.negative]="t.amount < 0">
                  {{ t.amount > 0 ? '+' : '' }}‚Çπ{{ t.amount | number:'1.2-2' }}
                </div>
                <div class="txn-date">{{ t.date }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notifications -->
        <div class="notifications-card">
          <div class="card-header">
            <div class="card-title">Notifications</div>
            <a href="#" class="see-all">Mark all read</a>
          </div>
          <div class="notif-list">
            <div class="notif-item" *ngFor="let n of notifications" [class.unread]="n.unread">
              <div class="notif-icon">{{ n.icon }}</div>
              <div class="notif-info">
                <div class="notif-message">{{ n.message }}</div>
                <div class="notif-time">{{ n.time }}</div>
              </div>
              <div class="unread-dot" *ngIf="n.unread"></div>
            </div>
          </div>
        </div>

      </div>
    </main>

  </ng-container>
</div>